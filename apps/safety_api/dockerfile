# 파이썬 슬림 버전 사용 (용량 절감)
FROM python:3.10-slim

# OpenCV 및 Whisper 실행에 필요한 최소 시스템 패키지 설치
RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0 \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# 라이브러리 설치 (캐시 활용을 위해 소스보다 먼저 복사)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 소스 코드 전체 복사 (app/, safety_modules/ 포함)
COPY . .

# 모듈 경로 에러 방지
ENV PYTHONPATH=/app

# 서버 실행 (포트 8000)
CMD ["python", "app/main.py"]